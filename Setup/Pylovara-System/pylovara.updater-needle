#!/bin/bash
# updater 0.3 version

# ğŸ’¡ Pylovara Updater (Reinstaller)
# FÃ¼hrt einen kompletten Update-Vorgang durch:
# Entfernt alte Installationen, klont Repo neu, kopiert in Keller

set -e
REPO_URL="https://github.com/Pylovara/Pylovara.git"
PV_DIR="/Pylovara"
WRAPPER_NAME="pylovara.wrapper-shell"
WRAPPER_PATH="/usr/local/bin/$WRAPPER_NAME"
TMP_DIR="/tmp/pylovara-latest"

echo "ğŸ› ï¸  Starte Pylovara-Update-Vorgang..."
echo "ğŸ› ï¸  alles auÃŸer der wrapper wird rekrusiv neuinstaliert"


# 1. Root-PrÃ¼fung
if [ "$EUID" -ne 0 ]; then
  echo "âŒ Dieses Skript muss mit sudo ausgefÃ¼hrt werden! = sudo ./pylovara.updater-needle"
  exit 1
fi

# 2. Alte Installationen lÃ¶schen
echo "ğŸ§¹ Entferne alte Installationen..."
rm -rf "$PV_DIR"
rm -rf "/home/"*/Pylovara 2>/dev/null || true

# 3. TMP-Verzeichnis vorbereiten
rm -rf "$TMP_DIR"
echo "â¬‡ï¸ Klone Repository nach TMP..."
git clone "$REPO_URL" "$TMP_DIR"

# 4. In Keller verschieben
echo "ğŸ“¦ Installiere neue Version nach $PV_DIR..."
cp -r "$TMP_DIR" "$PV_DIR"

# 5. TMP lÃ¶schen
echo "ğŸ§½ Entferne temporÃ¤re Daten..."
rm -rf "$TMP_DIR"

echo ""
echo "âœ… Pylovara wurde aktualisiert und neu installiert."
echo "ğŸ” Starte neue Shell"
echo "exec $WRAPPER_PATH"
