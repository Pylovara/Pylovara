#!/usr/bin/env bash
# Modul: protein.packet-parser.sh
# Zweck: Einzelne Â»[â€¦]Â«-Proteinpackete erkennen, analysieren & zerlegen

INPUT="$1"

# Funktion zum Parsen eines Proteinpackets
parse_proteinpacket() {
    local packet="$1"
    local clean="${packet#[}"
    clean="${clean%]}"

    IFS='|' read -ra parts <<< "$clean"

    echo "â”Œâ”€â”€ Protein-Paket Analyse â”€â”€â”€â”€â”€â”€â”€â”€"
    for entry in "${parts[@]}"; do
        key="${entry%%:*}"
        val="${entry#*:}"
        printf "â”‚ %12s : %s\n" "$key" "$val"
    done
    echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
}

# Extrahieren aller Proteinpackete aus Input
extract_packets() {
    local data="$1"
    grep -oP 'Â»\[\K[^\]]+(?=\]Â«)' <<< "$data" | while read -r raw; do
        parse_proteinpacket "[$raw]"
    done
}

# Test-Eingabe verarbeiten
if [[ -n "$INPUT" && -f "$INPUT" ]]; then
    extract_packets "$(cat "$INPUT")"
else
    echo "âš  Keine Datei Ã¼bergeben oder nicht vorhanden."
    echo "ðŸ›ˆ Aufruf: ./protein.packet-parser.sh path/to/file"
fi
