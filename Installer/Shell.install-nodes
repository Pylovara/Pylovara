#!/bin/bash

# installer.pylovara â€“ Pylovara Installer Script
# FÃ¼hre aus: ./installer.pylovara
# Wichtig: Muss mit root-Rechten laufen

echo "ğŸš€ Starte Pylovara Installation..."

# 1. PrÃ¼fe Root-Rechte
if [ "$EUID" -ne 0 ]; then 
  echo "âŒ Fehler: Dieses Skript benÃ¶tigt Root-Rechte. Verwende 'sudo' oder melde dich als Root an."
  exit 1
fi

# 2. Setze PV_DIR
export PV_DIR="/Pylovara"

# 3. Erstelle notwendige Ordner (falls noch nicht vorhanden)
mkdir -p /usr/local/bin/
mkdir -p "$PV_DIR/usr/bin/"

# 4. Kopiere den Wrapper nach /usr/local/bin/
cp "$PV_DIR/usr/bin/pylovara.wrapper-shell" /usr/local/bin/ || {
    echo "âŒ Fehler beim Kopieren des Wrappers"
    exit 1
}

chmod +x /usr/local/bin/pylovara.wrapper-shell || {
    echo "âŒ Fehler beim Setzen der Rechte fÃ¼r den Wrapper"
    exit 1
}

# 5. Trage Wrapper in /etc/shells ein (falls noch nicht vorhanden)
WRAPPER_SHELL="/usr/local/bin/pylovara.wrapper-shell"

if ! grep -Fxq "$WRAPPER_SHELL" /etc/shells; then
    echo "[+] FÃ¼ge Wrapper zur /etc/shells hinzu"
    echo "$WRAPPER_SHELL" >> /etc/shells
else
    echo "[!] Wrapper bereits in /etc/shells registriert"
fi

# 6. Ã„ndere die Standardshell fÃ¼r den aktuellen Nutzer
CURRENT_USER=$(whoami)
chsh -s /usr/local/bin/pylovara.wrapper-shell "$CURRENT_USER" || {
    echo "âŒ Fehler beim Setzen der neuen Shell fÃ¼r $CURRENT_USER"
    exit 1
}

# 7. Optional: FÃ¼ge source hinzu fÃ¼r Bash/Zsh-Nutzer
if [ -f /bin/bash ]; then
    BASHRC="$HOME/.bashrc"
    if ! grep -q "source \$PV_DIR/Control/control.pv-conf" "$BASHRC"; then
        echo "[+] FÃ¼ge source zu .bashrc hinzu"
        echo "source \$PV_DIR/Control/control.pv-conf" >> "$BASHRC"
    fi
fi

if [ -f /bin/zsh ]; then
    ZSHRC="$HOME/.zshrc"
    if ! grep -q "source \$PV_DIR/Control/control.pv-conf" "$ZSHRC"; then
        echo "[+] FÃ¼ge source zu .zshrc hinzu"
        echo "source \$PV_DIR/Control/control.pv-conf" >> "$ZSHRC"
    fi
fi

# 8. Fertig! Hinweis fÃ¼r Nutzer
echo ""
echo "âœ… Installation abgeschlossen!"
echo ""
echo "ğŸ”„ Terminal neu starten:"
echo "exec /usr/local/bin/pylovara.wrapper-shell"
echo ""
echo "ğŸ’¡ ODER einfach neu anmelden â€“ danach steht alles bereit."
echo ""
echo "ğŸ” Funktionen wie p, dna, helpme, ki sind ab jetzt global verfÃ¼gbar."

exit 0
